sequenceDiagram
    participant FS as Flight Service
    participant Saga as BookingSaga
    participant PS as Payment Service
    participant TS as Ticket Service

    FS->>Saga: FlightBookedEvent
    Saga->>FS: ReserveSeatCommand

    alt Seat reserved
        FS->>Saga: SeatReservedEvent
        Saga->>PS: ProcessPaymentCommand

        alt Payment successful
            PS->>Saga: PaymentProcessedEvent
            Saga->>TS: ConfirmBookingCommand
            Note right of Saga: Saga ends successfully
        else Payment failed
            PS->>Saga: PaymentFailedEvent
            Saga->>TS: CancelBookingCommand
            Saga->>FS: ReleaseSeatCommand
            Note right of Saga: Saga ends with compensation
        end

    else Seat reservation failed
        FS->>Saga: SeatReservationFailedEvent
        Saga->>TS: CancelBookingCommand
        Note right of Saga: Saga ends with compensation
    end
