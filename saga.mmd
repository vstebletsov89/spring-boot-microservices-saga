sequenceDiagram
    participant BOS as Booking Orchestrator Service
    participant RS as Reservation Service
    participant PS as Payment Service
    participant FCS as Flight Command Service
    participant FQS as Flight Query Service

    BOS->>RS: CreateReservationCommand
    RS->>BOS: ReservationCreatedEvent

    BOS->>FCS: ReserveSeatCommand
    alt Seat reserved
        FCS->>BOS: SeatReservedEvent
        BOS->>PS: ProcessPaymentCommand

        alt Payment successful
            PS->>BOS: PaymentProcessedEvent
            BOS->>RS: ConfirmReservationCommand
            Note right of BOS: Saga ends successfully
        else Payment failed
            PS->>BOS: PaymentFailedEvent
            BOS->>RS: CancelReservationCommand
            BOS->>FCS: ReleaseSeatCommand
            Note right of BOS: Saga ends with compensation
        end

    else Seat reservation failed
        FCS->>BOS: SeatReservationFailedEvent
        BOS->>RS: CancelReservationCommand
        Note right of BOS: Saga ends with compensation
    end

