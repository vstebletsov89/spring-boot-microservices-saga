sequenceDiagram
    participant UI as Client/User
    participant BOS as Booking Orchestrator Service
    participant FCS as Flight Service
    participant PS as Payment Service
    participant RS as Reservation Service

%% Saga start: booking created
    UI->>RS: Booking request (API)
    RS->>BOS: BookingCreatedEvent
    BOS->>FCS: ReserveSeatCommand

    alt Seat reserved
        FCS->>BOS: SeatReservedEvent
        BOS->>PS: ProcessPaymentCommand

        alt Payment successful
            PS->>BOS: PaymentProcessedEvent
            BOS->>RS: ConfirmBookingCommand
            Note right of BOS: Saga ends successfully

        else Payment failed
            PS->>BOS: PaymentFailedEvent
            BOS->>FCS: ReleaseSeatCommand
            BOS->>RS: ReservationCancelledCommand
            Note right of BOS: Saga ends with compensation (payment failed)
        end

    else Seat reservation failed
        FCS->>BOS: SeatReservationFailedEvent
        BOS->>RS: ReservationCancelledCommand
        Note right of BOS: Saga ends with compensation (seat not reserved)
    end

%% User-initiated booking cancellation
    UI->>RS: Cancel booking request (API)
    RS->>BOS: BookingCancellationRequestedEvent
    BOS->>FCS: ReleaseSeatCommand
    BOS->>PS: RefundPaymentCommand
    BOS->>RS: ReservationCancelledCommand
    Note right of BOS: Booking cancelled, seat released, payment refunded
